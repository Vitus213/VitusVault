---
week: 52
fellings:
tags:
  - review/daily
---

> [!quote] Only those who dare to fail greatly can ever achieve greatly.
> â€” Robert Kennedy

# æ˜ŸæœŸä¸€, åäºŒæœˆ 22æ—¥ 2025

[[ 2025-12-21 |â¬…ï¸ Yesterday]] | [[2025-12-23|â¡ï¸ Tomorrow]] | [[2025-w52|ğŸ“– Weekly]] | [[2025-12|ğŸ“… Monthly]]

```button
name Add to Log
type command
action QuickAdd: Capture to daily note
color default
```

## Daily Log
- **16:46** å¤ä¹ è¿˜æ˜¯codingè¿˜æ˜¯é¢è¯•

## TODO
### Study



### Work


## [[Tasks Dashboard |Tasks]]

> [!overdue]+ Due before 2025-12-22
> ```tasks
> due before 2025-12-22
> not done
> hide due date
> hide recurrence rule
> group by function task.tags.map( (tag) => tag.split('/')[1] ? tag.split('/').slice(0, 2).join('/') : '')
> ```

> [!due-today]+ Due 2025-12-22
> ```tasks
> due 2025-12-22
> not done
> hide due date
> hide recurrence rule
> group by function task.tags.map( (tag) => tag.split('/')[1] ? tag.split('/').slice(0, 2).join('/') : '')

> [!coming-soon]- Due soon after 2025-12-22
> ```tasks
> due after 2025-12-22
> due before 2025-12-26
> not done
> hide due date
> hide recurrence rule
> group by due
> group by function task.tags.map( (tag) => tag.split('/')[1] ? tag.split('/').slice(0, 2).join('/') : '')
> ```

> [!success]- Completed 2025-12-22
> ```tasks
> done 2025-12-22
> short mode
> ```

## ğŸ§  Tech Insights
> [!tip] æ¯æ—¥æŠ€æœ¯æ²‰æ·€ 

### ç«æ€æ¡ä»¶ï¼ˆRace Conditionï¼‰

å¹¶å‘ç¼–ç¨‹ä¸­çš„ä¸€ä¸ªç»å…¸é—®é¢˜ã€‚

```rust
 // æ—§ä»£ç 
  let handler = WakeUpHelper::new(ProcessManager::current_pcb());
  let timer = Timer::new(handler, jiffies);
  let irq_guard = unsafe { CurrentIrqArch::save_and_disable_irq() };
  ProcessManager::mark_sleep(true).ok();  // â† æ­¥éª¤ 1ï¼šæ ‡è®°ä¸ºç¡çœ çŠ¶æ€
  timer.activate();                        // â† æ­¥éª¤ 2ï¼šæ¿€æ´»å®šæ—¶å™¨
  drop(irq_guard);                         // â† æ­¥éª¤ 3ï¼šæ¢å¤ä¸­æ–­ï¼ˆå…è®¸å®šæ—¶å™¨è§¦å‘ï¼‰
  schedule(SchedMode::SM_NONE);            // â† æ­¥éª¤ 4ï¼šè®©å‡º CPUï¼Œè¿›å…¥ç¡çœ 
  ç«æ€çª—å£åœ¨è¿™é‡Œï¼š 
  æ—¶é—´çº¿ Aï¼ˆæ­£å¸¸æƒ…å†µï¼‰ï¼š
  t1: mark_sleep(true)           // æ ‡è®°ç¡çœ çŠ¶æ€
  t2: timer.activate()           // æ¿€æ´»å®šæ—¶å™¨
  t3: drop(irq_guard)            // æ¢å¤ä¸­æ–­
  t4: schedule()                 // è¿›å…¥ç¡çœ  âœ…
  t5: [1ç§’å] å®šæ—¶å™¨è§¦å‘ â†’ å”¤é†’è¿›ç¨‹ âœ…

  æ—¶é—´çº¿ Bï¼ˆç«æ€æ¡ä»¶ï¼‰ï¼š
  t1: mark_sleep(true)           // æ ‡è®°ç¡çœ çŠ¶æ€
  t2: timer.activate()           // æ¿€æ´»å®šæ—¶å™¨ï¼ˆå‡è®¾è¶…æ—¶è®¾ç½®ä¸º 1Î¼sï¼‰
  t3: drop(irq_guard)            // æ¢å¤ä¸­æ–­
  t3.5: [å®šæ—¶å™¨ç«‹å³è§¦å‘ï¼] â†’ WakeUpHelper å”¤é†’è¿›ç¨‹
        â†’ è¿›ç¨‹è¢«æ ‡è®°ä¸ºå¯è¿è¡ŒçŠ¶æ€
  t4: schedule() â† ä½†è¿™é‡Œè¿˜æ˜¯ä¼šè®©è¿›ç¨‹ç¡çœ ï¼âŒ
      å› ä¸º schedule() ä¸çŸ¥é“åœ¨ t3.5 å·²ç»æœ‰äººæƒ³å”¤é†’æˆ‘äº†
 ç»“æœï¼šè¿›ç¨‹æ°¸ä¹…ç¡çœ  âŒï¼ˆå”¤é†’ä¿¡å·ä¸¢å¤±ï¼‰
  ä¸ºä»€ä¹ˆä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ
    1. æ­¥éª¤ 2 åˆ°æ­¥éª¤ 4 ä¹‹é—´æœ‰ä¸€ä¸ª"çª—å£æœŸ"
    2. å¦‚æœå®šæ—¶å™¨åœ¨è¿™ä¸ªçª—å£æœŸå†…è§¦å‘ï¼Œå®ƒä¼šè°ƒç”¨ WakeUpHelper å”¤é†’è¿›ç¨‹
    3. ä½†æ­¤æ—¶è¿›ç¨‹è¿˜æ²¡çœŸæ­£ç¡çœ ï¼ˆschedule è¿˜æ²¡æ‰§è¡Œï¼‰
    4. åç»­ schedule() ä¼šè®©è¿›ç¨‹ç¡çœ ï¼Œä½†å”¤é†’ä¿¡å·å·²ç»å‘ç”Ÿå¹¶ä¸¢å¤±äº†
    5. è¿›ç¨‹ä¼šæ°¸ä¹…ç¡çœ ï¼Œå› ä¸ºå®šæ—¶å™¨å·²ç»è§¦å‘è¿‡ï¼Œä¸ä¼šå†è§¦å‘ç¬¬äºŒæ¬¡
```

  æ–°ä»£ç å¦‚ä½•è§£å†³

```rust
  // æ–°ä»£ç 
  let (waiter, waker) = Waiter::new_pair();
  let timer = Timer::new(TimeoutWaker::new(waker.clone()), jiffies);
  timer.activate();  // â† æ¿€æ´»å®šæ—¶å™¨ï¼ˆå¯èƒ½ç«‹å³è§¦å‘ï¼‰
  let wait_res = waiter.wait(true);  // â† å…³é”®ï¼šå†…éƒ¨æœ‰åŸå­æ£€æŸ¥
  waiter.wait() å†…éƒ¨çš„å…³é”®é€»è¾‘ï¼ˆwait_queue.rs:200-240ï¼‰ï¼š
  fn wait(&self, interruptible: bool) -> Result<(), SystemError> {
      // 1. ç¦ç”¨ä¸­æ–­ï¼ˆé˜²æ­¢è¢«æ‰“æ–­ï¼‰
      let irq_guard = unsafe { CurrentIrqArch::save_and_disable_irq() };
       // 2. æ ‡è®°ä¸ºç¡çœ çŠ¶æ€
  ProcessManager::mark_sleep(interruptible)?;
  // 3. å…³é”®æ£€æŸ¥ï¼šåŸå­åœ°æ£€æŸ¥æ˜¯å¦å·²è¢«å”¤é†’
  if self.inner.has_woken.load(Ordering::Acquire) {
      // å¦‚æœå·²ç»è¢«å”¤é†’ï¼ˆå®šæ—¶å™¨å·²è§¦å‘ï¼‰ï¼Œç«‹å³è¿”å›ï¼Œä¸ç¡çœ ï¼
      ProcessManager::mark_wakeup_cpu_idle()?;
      drop(irq_guard);
      return Ok(());  // â† ç›´æ¥è¿”å›ï¼Œé¿å…ç¡çœ 
  }

  // 4. åªæœ‰åœ¨æœªè¢«å”¤é†’çš„æƒ…å†µä¸‹æ‰çœŸæ­£ç¡çœ 
  drop(irq_guard);
  schedule(SchedMode::SM_NONE);

  // ... åç»­å¤„ç†
    }
  æ–°ä»£ç çš„æ—¶é—´çº¿ï¼š
  æ—¶é—´çº¿ï¼ˆå®šæ—¶å™¨æå‰è§¦å‘ï¼‰ï¼š
  t1: timer.activate()           // æ¿€æ´»å®šæ—¶å™¨
  t2: [å®šæ—¶å™¨ç«‹å³è§¦å‘]
      â†’ TimeoutWaker::run()
      â†’ waker.wake()
      â†’ has_woken = true âœ…      // è®¾ç½®åŸå­æ ‡å¿—
      â†’ å”¤é†’è¿›ç¨‹ï¼ˆä½†è¿›ç¨‹è¿˜æ²¡ç¡ï¼‰
  t3: waiter.wait(true)
      â†’ mark_sleep(true)
      â†’ æ£€æŸ¥ has_woken â† å‘ç°ä¸º trueï¼
      â†’ ç«‹å³è¿”å›ï¼Œä¸è°ƒç”¨ schedule() âœ…
  ç»“æœï¼šä¸ä¼šç¡çœ ï¼Œæ­£å¸¸è¿”å› âœ…
```

#### å…³é”®å·®å¼‚ï¼š

| æ—§ä»£ç                                    | æ–°ä»£ç                                    |
| ---------------------------------------- | ---------------------------------------- |
| å”¤é†’ä¿¡å·ï¼šç›´æ¥å”¤é†’ PCB                   | å”¤é†’ä¿¡å·ï¼šè®¾ç½® has_woken æ ‡å¿— + å”¤é†’ PCB |
| ç¡çœ å‰ï¼šæ— æ£€æŸ¥                           | ç¡çœ å‰ï¼šæ£€æŸ¥ has_woken æ ‡å¿—              |
| ç«æ€çª—å£ï¼štimer.activate() åˆ° schedule() | æ— ç«æ€ï¼šåŸå­æ ‡å¿—åŒæ­¥                     |

---

#### ç«æ€æ¡ä»¶çš„ä¸‰ä¸ªè¦ç´ 

å…±äº«èµ„æºï¼ˆShared Resourceï¼‰

- æ—§ä»£ç ï¼šè¿›ç¨‹çš„ç¡çœ /å”¤é†’çŠ¶æ€
- æ–°ä»£ç ï¼šhas_woken åŸå­æ ‡å¿—

å¹¶å‘è®¿é—®ï¼ˆConcurrent Accessï¼‰

- ä¸»çº¿ç¨‹ï¼šè°ƒç”¨ schedule() è®©è¿›ç¨‹ç¡çœ 
- ä¸­æ–­ä¸Šä¸‹æ–‡ï¼šå®šæ—¶å™¨è§¦å‘ï¼Œå”¤é†’è¿›ç¨‹

ä¾èµ–æ—¶åºï¼ˆTiming-Dependentï¼‰

- å¦‚æœå®šæ—¶å™¨æ™šè§¦å‘ â†’ æ­£å¸¸å·¥ä½œ âœ…
- å¦‚æœå®šæ—¶å™¨æ—©è§¦å‘ â†’ æ—§ä»£ç å‡ºé—®é¢˜ âŒï¼Œæ–°ä»£ç æ­£å¸¸ âœ…

#### å¦‚ä½•è¯†åˆ«ç«æ€æ¡ä»¶

æœ‰æ²¡æœ‰å…±äº«æ•°æ®ï¼Ÿï¼ˆå¤šä¸ªçº¿ç¨‹/ä¸­æ–­è®¿é—®åŒä¸€å˜é‡ï¼‰

æ“ä½œæ˜¯åŸå­çš„å—ï¼Ÿï¼ˆè¯»-ä¿®æ”¹-å†™æ˜¯ä¸€ä¸ªæ•´ä½“å—ï¼Ÿï¼‰

æ—¶åºä¼šå½±å“ç»“æœå—ï¼Ÿï¼ˆæ¢ä¸ªé¡ºåºä¼šå‡ºé”™å—ï¼Ÿï¼‰

---

### è§£å†³ç«æ€æ¡ä»¶çš„æ–¹æ³•

| æ–¹æ³•                 | ä¾‹å­                           | ä½ çš„ä»£ç                  |
| -------------------- | ------------------------------ | ------------------------ |
| åŸå­æ“ä½œ             | AtomicBool::compare_exchange() | has_woken.load()/store() |
| é”ï¼ˆMutex/SpinLockï¼‰ | Mutex::lock()                  | irq_guardï¼ˆä¸­æ–­é”ï¼‰      |
| æ— é”æ•°æ®ç»“æ„         | Arc<AtomicPtr>                 | Waiter/Waker è®¾è®¡        |
| æ¶ˆæ¯ä¼ é€’             | channel.send()/recv()          | -                        |
| äº‹åŠ¡å†…å­˜             | æ•°æ®åº“äº‹åŠ¡                     | -                        |





# ğŸ“… 2025-12-22

> [!sun] Morning
> **3 things I am grateful for...**
> 1. 
> 2. 
> 3. 
>
> **What will I do to make today great?**
> - [ ] 
> - [ ] 
>
> **Daily affirmations**
> - 

> [!moon] Evening
> **What were the highlights from your day?**
> 1. å¤šæ‹‰è´¡osäº¤äº†ä¸¤ä¸ªcommitï¼Œäº¤äº†ä¸€ä¸ªpr
> 2. é¢è¯•å¼€å§‹çœ‹äº†
> 3. æ²¡æ€ä¹ˆæ‰“æ¸¸æˆä»Šå¤©ï¼Œå°±æ‰“äº†ä¸¤å°æ—¶
>
> **How could I have made today even better?**
>
> - å°‘åˆ·è§†é¢‘

## Today's Notes

> [!example]- Created Today
> ```dataview
> table without id
> file.link as Note,
> file.folder as Folder,
> file.ctime as "Created"
> FROM ""
> where file.ctime >= date(2025-12-22) AND file.ctime <= date(2025-12-23) AND file.path != this.file.path
> sort file.ctime desc
> ```

> [!example]- Modified Today
> ```dataview
> table without id
> file.link as Note,
> file.folder as Folder,
> file.mtime as "Last Modified"
> FROM ""
> where file.mtime >= date(2025-12-22) AND file.mtime <= date(2025-12-23) AND file.path != this.file.path
> sort file.mtime desc
> ```